@layout EmptyLayout
@page "/"
@using MoneyNoteLibrary5.ViewModels;
@inject IJSRuntime JS;

<div>
    <h1>MoneyNote</h1>

    Welcome to your new app.

    <SurveyPrompt Title="How is Blazor working for you?" />
    <input type="text" @bind="ViewModel.Email" />
    <input type="password" @bind="ViewModel.Password" />
    <button type="button" @onclick="Login">로그인</button>
</div>

@code
{
    [Inject]
    public NavigationManager NavigationManager { get; set; }

    public LoginViewModel ViewModel { get; set; } = new LoginViewModel();

    private async Task Login()
    {
        if (!ViewModel.IsEnableLogin)
            return;

        var result = await ViewModel.LogIn();
        if (result.Item1)
        {
            SharedClass.SharedUser = result.Item2;
            var saveResult = await JS.InvokeAsync<bool>("SetUserInfo", JsonConvert.SerializeObject(result.Item2));

            if (NavigationManager != null)
                NavigationManager.NavigateTo("/Money/MoneyList");
        }
    }
}